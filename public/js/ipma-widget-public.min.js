!function(t){"use strict";var a=null;t(document).on("ready",function(){var e=t("[data-ipma-widget]");e.length&&e.each(function(e){var i=t(this),n=i.attr("id"),r=null,o=null,d=function(){var t=11;if(f()){var a=localStorage.getItem(n+"_ipma_widget_district");null!=a&&(t=parseInt(a))}return t},l=function(){var t=1110600;if(f()){var a=localStorage.getItem(n+"_ipma_widget_location");null!=a&&(t=parseInt(a))}return t},s=function(a){var e="//api.ipma.pt/json/alldata/"+String(a)+".json";t.ajax({url:e}).then(function(t){for(var a=0;a<t.length;a++){var e=t[a];if(24==e.idPeriodo){var n=m(e.dataPrev),r=i.find("[data-ipma-forecast='"+n+"']");if(r.length){var o=p(e.idTipoTempo);r.find("[data-ipma-forecast-mintemp]").html(parseInt(e.tMin)),r.find("[data-ipma-forecast-maxtemp]").html(parseInt(e.tMax)),r.find("[data-ipma-forecast-precip]").html(parseInt(e.probabilidadePrecipita)),r.find("[data-ipma-forecast-icon]").parent().removeClass("disabled"),r.find("[data-ipma-forecast-icon]").attr("src","//www.ipma.pt/opencms/bin/images.site/otempo/prev.horaria/w_ic_d_"+o+".gif"),void 0!==ipmaWidget_i18n["forecast"+o]&&r.find("[data-ipma-forecast-icon]").attr("title",ipmaWidget_i18n["forecast"+o])}}}})},c=function(e){if(null==a){t.ajax({url:"//api.ipma.pt/json/locations.json"}).then(function(t){a=t,r.trigger("change")});return null}for(var i=[],n=0;n<a.length;n++){var o=a[n];if(o.idDistrito==e){var d=!1;o.globalIdLocal==l()&&(d=!0);var s=new Option(o.local,o.globalIdLocal,d,d);i.push(s)}}return i},p=function(t){return t<10&&(t="0"+t),t},m=function(t){var a=new Date(t),e=""+(a.getMonth()+1),i=""+a.getDate(),n=a.getFullYear();return e.length<2&&(e="0"+e),i.length<2&&(i="0"+i),[n,e,i].join("-")},f=function(){var t="test_string";try{return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch(t){return!1}};!function(){(r=i.find("[data-ipma-widget-district]").attr("disabled","disabled").select2()).data("select2").$dropdown.addClass("ipma-widget-select-dropdown"),(o=i.find("[data-ipma-widget-location]").attr("disabled","disabled").select2()).data("select2").$dropdown.addClass("ipma-widget-select-dropdown");t.ajax({url:"//api.ipma.pt/json/districts.json"}).then(function(a){var e=d();r.empty();for(var i=0;i<a.length;i++){var n=!1;a[i].idDistrito===e&&(n=!0);var o=new Option(a[i].nome,a[i].idDistrito,n,n);r.append(o)}r.removeAttr("disabled"),r.trigger("change"),t("[data-ipma-widget-forecasts]").removeClass("hidden").slideDown()}).fail(function(a,e,i){t("[data-ipma-widget-unavailabe]").removeClass("hidden").slideDown()});r.on("change",function(a){var e=t(this).val(),i=c(e);if(null===i)return!1;i.sort(function(t,a){return t.label.localeCompare(a.label)}),o.empty().append(i),o.removeAttr("disabled"),o.trigger("change")}),o.on("change",function(a){var e=t(this).val();s(e),localStorage.setItem(n+"_ipma_widget_location",e),localStorage.setItem(n+"_ipma_widget_district",r.val())})}()})})}(jQuery);